<!DOCTYPE html>
<html>

<head>
    <title>FPS Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="animation.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- shtut revised -->
</head>

</html>
</head>

<body>
    <h1>FPS Calculator</h1>


    <form action="javascript:void(0)">
        <div class="box">

            <div class="selectbox">
                <select class = "selectush" id="camera" oninput="updateModes();stateValidate();">
                    <option value="">Select a camera</option>
                </select>
    
                <select class= "selectush" id="modes" oninput="stateValidate();">
                    <option value="">Mode</option>
                </select>
            </div>
       
            


            <div class="ranger">
                <label for="height">Height:</label>
                <input type="range" id="height" name="height" min="4" max="" onchange="stateValidate();"
                    oninput="updateNumber(this.value, 'height-value'); stateValidate()">
                <input type="number" class='sliderVal' id="height-value"
                    oninput="updateNumber(this.value, 'height'); stateValidate();"></input>
            </div>

            <div class="ranger">
                <label for="width">Width:</label>
                <input type="range" id="width" name="width" min="4" max="" onchange="stateValidate(); "
                    oninput="updateNumber(this.value, 'width-value');stateValidate()">
                <input type="number" class='sliderVal' id="width-value"
                    oninput="updateNumber(this.value, 'width'); stateValidate()"></input>
            </div>


            <div class="smallSelects">
                <div>
                    <label for="interface">Interface:</label>
                    <select id="interface" onchange="stateValidate()"></select>
                </div>
                <div id ="linkDaddy">
                    <label for="links">Links:</label>
                    <select id="links" onchange="stateValidate()">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="4">4</option>
                    </select>
                </div>
                <div>
                    <label for="bitness">Bit Depth:</label>
                    <select id="bitness" onchange="stateValidate()">
                        <option value="8">8</option>
                        <option value="10">10</option>
                        <option value="12">12</option>
                    </select>
                </div>
            </div>
            <!-- <button onclick="addwiggle(); calculate()">Calculate</button> -->
            <div class="rapperesult">
                <div id="result"></div>
            </div>
        </div>
    </form>
    <script src="consts.mjs"></script>
    <script src="functions.mjs"></script>
    <script>
    
    const say = console.log
        let sensorInfo = {};
        const widthSlider =  document.getElementById("width")
        const widthInput =  document.getElementById("width-value")
        const heightSlider =  document.getElementById("height")
        const heightInput =  document.getElementById("height-value")

        function stateValidate(){
            const camera = document.getElementById("camera").value;
            const mode = document.getElementById("modes").value;
            sensorInfo = sensor(camera, mode);
            document.getElementById("linkDaddy").classList.toggle("hidden", sensorInfo["type"]== "25x")
            const heightMax = sensorInfo['Max Height (V)']
            const widthMax = sensorInfo['Max Width (H)']
            heightSlider.max = heightMax;
            widthSlider.max = widthMax;
            dontExceedMax(heightInput, heightMax)
            dontExceedMax(heightSlider, heightMax)
            dontExceedMax(widthInput, widthMax)
            dontExceedMax(widthSlider, widthMax)
            calculate()

        }

        function dontExceedMax(element, max){
            if (element.value > max){
                element.value = max
            }
        }

        function updateNumber(value, elementId) {
            document.getElementById(elementId).value = value;
        }


        function addwiggle() {
            const element = document.getElementById("result")
            element.classList.add("wiggle");
            setTimeout(function () {
                element.classList.remove("wiggle");
            }, 300);
        }

        function calculate() {
            const camera = document.getElementById("camera").value;
            const mode = document.getElementById("modes").value
            console.log(camera, mode);
            const width = + document.getElementById("width").value;
            const height = + document.getElementById("height").value;
            const interface = document.getElementById("interface").value;
            const links = + document.getElementById("links").value;
            const bitness = + document.getElementById("bitness").value;
            const resultDiv = document.getElementById("result");
            for (const element of [camera, mode, width, height, interface, links, bitness]) {
                if (!element || element == '') {
                    resultDiv.innerHTML = `Some of the fields are missing`
                    return undefined
                }
            }
            // Call getSensorProperties() function with selected values
            const result = getFps_main(camera,mode, width, height, interface, links, bitness);
            resultDiv.innerHTML = result + " fps"
            if (isNaN(result)){
                resultDiv.innerHTML = "This Bit depth is not available for this Camera"
            }
            
            addwiggle()
            return result
        }


        let cameras = getAllcamerasNames();
        for (var i = 0; i < cameras.length; i++) {
            var option = document.createElement("option");
            option.text = cameras[i];
            document.getElementById("camera").add(option);
        }

        function updateModes(){
            const camera = document.getElementById("camera").value;
            const modes = getModes(camera) 
            document.getElementById("modes").innerHTML = ""
            for (let i = 0; i < modes.length; i++) {
            let option = document.createElement("option");
            option.text = modes[i];
            document.getElementById("modes").add(option);
        }

        }

        for (let i = 0; i < interfaces.length; i++) {
            var option = document.createElement("option");
            option.text = interfaces[i];
            document.getElementById("interface").add(option);
    
        }

        </script>
</body>

</html>
